@RunWith(AndroidJUnit4::class)
@SmallTest
class Kakao_LoginTest {

    private val loginFragment = LoginFragment()

    @Rule
    var mainActivity = ActivityTestRule(MainActivity::class.java, false, true)

    @Before
    fun setUp() {
        mainActivity
                .activity
                .supportFragmentManager
                .beginTransaction()
                .add(R.id.fragmentContainer, loginFragment)
                .commit()
    }

    @Test
    fun chooseCorrectPrefix() {
        BaristaSleepInteractions.sleep(500)
        Espresso.onView(AllOf.allOf(ViewMatchers.withId(R.id.arrow), ViewMatchers.isDescendantOfA(ViewMatchers.withId(R.id.prefixSpinner))))
                .check(ViewAssertions.matches(ViewMatchers.isDisplayed()))
                .perform(ViewActions.click())
    }

    @Test
    fun fillPhoneNumberFieldWithCorrectPhoneNumber() {
        onScreen<LoginScreen> {
            phoneNumberField {
                click()
                clearText()
                typeText(ValuesForTests.CorrectPhoneNumber)
            }
        }
    }

    @Test
    fun fillPasswordFieldWithCorrectPassword() {
        onScreen<LoginScreen> {
            passwordField {
                click()
                clearText()
                typeText(ValuesForTests.CorrectPassword)
            }
        }
    }

    @Test
    fun clickResetPasswordTextToOpenResetPassswordView() {
        onScreen<LoginScreen> {
            resetPasswordText {
                isClickable()
                click()
            }
        }
    }

    @Test
    fun clickLoginButton() {
        BaristaSleepInteractions.sleep(300)
        onScreen<LoginScreen> {
            loginButton {
                isEnabled()
                click()
            }
        }
    }

    @Test
    fun clickRegistrationTextToOpenRegistrationView() {
        onScreen<LoginScreen> {
            registerText {
                isClickable()
                click()
            }
        }
    }
}
